<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SIP Dialer</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>📞 SIP Dialer</h1>
      <div id="connectionStatus" class="status">Not Connected</div>
    </div>

    <!-- Tab Navigation -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="dialer">📞 Dialer</button>
      <button class="tab-btn" data-tab="numbers">📋 Numbers</button>
      <button class="tab-btn" data-tab="autodialer">🤖 Auto Dialer</button>
      <button class="tab-btn" data-tab="config">⚙️ Configuration</button>
      <button class="tab-btn" data-tab="history">📜 History</button>
    </div>

    <!-- Tab: Dialer -->
    <div class="tab-content active" id="tab-dialer">
      <div class="dialer-panel">
        <!-- Connection Status -->
        <div class="config-section">
          <h2>Softswitch Configuration</h2>
          <div class="form-group">
            <label for="sipServer">SIP Server (WebSocket):</label>
            <input type="text" id="sipServer" placeholder="ws://127.0.0.1:8088/ws" value="ws://127.0.0.1:8088/ws">
            <small style="color: #666; display: block; margin-top: 5px;">Enter WebSocket URL (wss:// for secure, ws://
              for
              testing). Point this to a WebRTC-enabled SIP gateway like Asterisk/FreeSWITCH/Kamailio.</small>
          </div>
          <div class="form-group">
            <label for="username">Username/Extension:</label>
            <input type="text" id="username" placeholder="Enter SIP username" value="1001">
          </div>
          <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" id="password" placeholder="Enter SIP password" value="websecret">
          </div>
          <div class="form-group">
            <label for="realm">Realm/Domain (optional):</label>
            <input type="text" id="realm" placeholder="e.g., yourdomain.com">
          </div>
          <div class="form-group">
            <label>
              <input type="checkbox" id="autoHangupEnabled" checked>
              Auto-hangup calls after random duration
            </label>
          </div>
          <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div>
              <label for="autoHangupMin">Min (seconds):</label>
              <input type="number" id="autoHangupMin" value="180" min="1" style="width: 100%;">
            </div>
            <div>
              <label for="autoHangupMax">Max (seconds):</label>
              <input type="number" id="autoHangupMax" value="240" min="1" style="width: 100%;">
            </div>
          </div>
          <button id="connectBtn" class="btn btn-primary">Connect</button>
          <button id="disconnectBtn" class="btn btn-secondary" disabled>Disconnect</button>
          <div id="connectionStatus" class="status">Not Connected</div>
        </div>

        <!-- Asterisk Configuration Panel -->
        <div class="config-section" style="background: #f0f8ff; border: 2px solid #0066cc;">
          <h2 style="color: #0066cc;">⚙️ Asterisk Gateway Configuration</h2>
          <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
            Configure your Asterisk gateway settings. These settings are applied to your local Asterisk Docker instance.
          </p>

          <div class="form-group">
            <label for="asteriskTrunkHost">VOS3000 Trunk Host:</label>
            <input type="text" id="asteriskTrunkHost" placeholder="IP address" value="104.248.249.40">
            <small style="color: #666; display: block; margin-top: 5px;">IP address of your VOS3000 softswitch</small>
          </div>

          <div class="form-group">
            <label for="asteriskTrunkPort">VOS3000 Trunk Port:</label>
            <input type="number" id="asteriskTrunkPort" placeholder="5060" value="5060" min="1" max="65535">
            <small style="color: #666; display: block; margin-top: 5px;">SIP port (default: 5060)</small>
          </div>

          <div class="form-group">
            <label for="asteriskRegisterUser">Registration Username:</label>
            <input type="text" id="asteriskRegisterUser" placeholder="SIP username" value="4942139974006">
            <small style="color: #666; display: block; margin-top: 5px;">Username for registering to VOS3000</small>
          </div>

          <div class="form-group">
            <label for="asteriskRegisterPassword">Registration Password:</label>
            <input type="password" id="asteriskRegisterPassword" placeholder="Password" value="msowu204$">
            <small style="color: #666; display: block; margin-top: 5px;">Password for VOS3000 authentication</small>
          </div>

          <div class="form-group">
            <label for="asteriskCallerId">Caller ID Number:</label>
            <input type="text" id="asteriskCallerId" placeholder="Caller ID" value="4942139974006">
            <small style="color: #666; display: block; margin-top: 5px;">Outbound caller ID to present</small>
          </div>

          <div class="form-group">
            <label for="asteriskCodecs">Allowed Codecs:</label>
            <input type="text" id="asteriskCodecs" placeholder="alaw,ulaw" value="alaw,ulaw">
            <small style="color: #666; display: block; margin-top: 5px;">Comma-separated codec list (e.g.,
              alaw,ulaw,g729)</small>
          </div>

          <div class="form-group">
            <label for="asteriskWebRTCPort">WebRTC WebSocket Port:</label>
            <input type="number" id="asteriskWebRTCPort" placeholder="8088" value="8088" min="1" max="65535">
            <small style="color: #666; display: block; margin-top: 5px;">Port for browser WebSocket connection</small>
          </div>

          <div style="display: flex; gap: 10px; margin-top: 15px;">
            <button id="applyAsteriskConfigBtn" class="btn btn-primary" style="flex: 1;">
              💾 Apply Configuration
            </button>
            <button id="regenerateAsteriskConfigBtn" class="btn btn-secondary" style="flex: 1;">
              🔄 Regenerate Config Files
            </button>
            <button id="restartAsteriskBtn" class="btn" style="flex: 1; background: #ff6b6b; color: white;">
              🔃 Restart Asterisk
            </button>
          </div>

          <div id="asteriskConfigStatus"
            style="margin-top: 10px; padding: 10px; background: white; border-radius: 4px; font-size: 13px; color: #666; text-align: center; display: none;">
            Configuration status will appear here
          </div>

          <details style="margin-top: 15px; padding: 10px; background: white; border-radius: 4px;">
            <summary style="cursor: pointer; font-weight: bold; color: #0066cc;">📋 Show Generated Configuration Preview
            </summary>
            <div style="margin-top: 10px;">
              <h4 style="margin: 10px 0 5px 0;">pjsip.conf (Endpoints & Registration)</h4>
              <pre id="pjsipConfigPreview"
                style="background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; max-height: 300px; overflow-y: auto;"></pre>

              <h4 style="margin: 15px 0 5px 0;">extensions.conf (Dialplan)</h4>
              <pre id="extensionsConfigPreview"
                style="background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; max-height: 200px; overflow-y: auto;"></pre>
            </div>
          </details>
        </div>

        <!-- Predefined Numbers -->
        <div class="numbers-section">
          <h2>Predefined Numbers</h2>
          <div class="form-group">
            <label for="newNumber">Add New Number:</label>
            <input type="text" id="newNumber" placeholder="Enter phone number">
            <input type="text" id="newNumberLabel" placeholder="Label (optional)">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
              <input type="number" id="newNumberMinDuration" placeholder="Min duration (sec)" value="180" min="1">
              <input type="number" id="newNumberMaxDuration" placeholder="Max duration (sec)" value="240" min="1">
            </div>
            <button id="addNumberBtn" class="btn btn-small" style="margin-top: 10px;">Add</button>
          </div>
          <div style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <h3 style="margin: 0 0 10px 0; font-size: 14px; color: #333;">Multi-Call Settings</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
              <input type="number" id="batchMinDuration" placeholder="Min duration (sec)" value="180" min="1"
                style="padding: 8px;">
              <input type="number" id="batchMaxDuration" placeholder="Max duration (sec)" value="240" min="1"
                style="padding: 8px;">
            </div>
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
              <button id="callSelectedBtn" class="btn btn-primary" style="flex: 1;">📞 Call Selected</button>
              <button id="selectAllBtn" class="btn btn-secondary" style="flex: 1;">☑️ Select All</button>
              <button id="deselectAllBtn" class="btn btn-secondary" style="flex: 1;">⬜ Deselect All</button>
            </div>

            <h4
              style="margin: 15px 0 10px 0; font-size: 13px; color: #333; border-top: 1px solid #ddd; padding-top: 15px;">
              Auto Dialer</h4>
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
              <input type="checkbox" id="autoDialerEnabled" style="width: 20px; height: 20px; cursor: pointer;">
              <label for="autoDialerEnabled" style="cursor: pointer; margin: 0;">Enable Auto Dialer</label>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
              <div>
                <label style="font-size: 12px; color: #666;">Min Delay (seconds)</label>
                <input type="number" id="autoDialerMinDelay" placeholder="Min delay" value="30" min="1"
                  style="padding: 8px; width: 100%;">
              </div>
              <div>
                <label style="font-size: 12px; color: #666;">Max Delay (seconds)</label>
                <input type="number" id="autoDialerMaxDelay" placeholder="Max delay" value="60" min="1"
                  style="padding: 8px; width: 100%;">
              </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
              <div>
                <label style="font-size: 12px; color: #666;">Min Pause After Connect (sec)</label>
                <input type="number" id="autoDialerMinPauseAfterConnect" placeholder="Min pause" value="5" min="0"
                  style="padding: 8px; width: 100%;">
              </div>
              <div>
                <label style="font-size: 12px; color: #666;">Max Pause After Connect (sec)</label>
                <input type="number" id="autoDialerMaxPauseAfterConnect" placeholder="Max pause" value="15" min="0"
                  style="padding: 8px; width: 100%;">
              </div>
            </div>
            <div style="margin-bottom: 10px;">
              <label style="font-size: 12px; color: #666;">Maximum Active Calls</label>
              <input type="number" id="autoDialerMaxActiveCalls" placeholder="Max active calls" value="1" min="1"
                style="padding: 8px; width: 100%;">
            </div>
            <div style="display: flex; gap: 10px;">
              <button id="startAutoDialerBtn" class="btn btn-success" style="flex: 1;">▶️ Start Auto Dialer</button>
              <button id="stopAutoDialerBtn" class="btn btn-danger" style="flex: 1;" disabled>⏹️ Stop Auto
                Dialer</button>
            </div>
            <div id="autoDialerStatus"
              style="margin-top: 10px; padding: 8px; background: #fff; border-radius: 4px; font-size: 12px; color: #666; text-align: center;">
              Auto Dialer: Stopped
            </div>
          </div>
          <div id="numbersList" class="numbers-list">
            <!-- Numbers will be added here dynamically -->
          </div>
        </div>

        <!-- Call Controls -->
        <div class="call-section">
          <h2>Active Calls</h2>
          <div id="callStatus" class="call-status">No active calls</div>
          <div id="activeCallsList" style="margin: 15px 0;"></div>
          <div class="call-controls">
            <button id="muteBtn" class="btn btn-secondary" disabled>🔇 Mute</button>
            <button id="hangupBtn" class="btn btn-danger" disabled>Hang Up All</button>
          </div>
          <div class="audio-controls">
            <label>Volume: <input type="range" id="volumeControl" min="0" max="100" value="80"></label>
          </div>
        </div>

        <!-- Hidden audio elements for remote audio -->
        <audio id="remoteAudio" autoplay></audio>
        <audio id="ringbackTone" loop>
          <source
            src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAAABmYWN0BAAAAAAAAABkYXRhAAAAAA=="
            type="audio/wav">
        </audio>

        <!-- Call History -->
        <div class="history-section">
          <h2>Call History</h2>
          <div id="callHistory" class="call-history">
            <!-- Call history will be added here -->
          </div>
        </div>
      </div>

      <!-- Include JsSIP library (production) -->
      <script src="jssip.min.js"></script>
      <script src="script.js"></script>
</body>

</html>